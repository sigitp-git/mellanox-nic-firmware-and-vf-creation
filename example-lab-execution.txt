$ aws ssm start-session --t i-123456789

Starting session with SessionId: i-123456789-pzi94nd4njxn766p8fhv2lur5a
sh-5.2$ cd
sh-5.2$ sudo yum install git -y 

sh-5.2$ sudo ./quick-test.sh
üöÄ Quick Test - Mellanox ConnectX-7 Scripts
===========================================

üìÅ Checking required files...
  ‚úì install-mft.sh
  ‚úì install-cx7-firmware.sh
  ‚úì update-cx7-firmware.sh
  ‚úì firmware-config.json
  ‚úì mlx-nic-health-check.sh

üîß Checking script permissions...
  ‚úì install-mft.sh (executable)
  ‚úì install-cx7-firmware.sh (executable)
  ‚úì update-cx7-firmware.sh (executable)
  ‚úì mlx-nic-health-check.sh (executable)

‚ùì Testing help functions...
  ‚úì install-mft.sh --help works
  ‚úì install-cx7-firmware.sh --help works
  ‚úì update-cx7-firmware.sh --help works
  ‚úì mlx-nic-health-check.sh --help works

üìã Validating JSON configuration...
  ‚úì firmware-config.json is valid

üåê Testing network connectivity...
  ‚úì NVIDIA website reachable

üîç Checking for ConnectX-7 hardware...
  ‚úì Found 4 ConnectX-7 device(s)

‚úÖ Quick test completed!

Next steps:
  ‚Ä¢ Run './test-all-scripts.sh' for comprehensive testing
  ‚Ä¢ Test with actual hardware if available
  ‚Ä¢ Run as root for full hardware validation


===========================================

sh-5.2$ ./test-all-scripts.sh 
üß™ Starting Comprehensive Test Suite for Mellanox ConnectX-7 Scripts
Test Log: /tmp/mellanox-test-20250825_002716.log

2025-08-25 00:27:16 - TEST: Checking script file existence
‚ÑπÔ∏è  Found: install-mft.sh
‚ÑπÔ∏è  Found: install-cx7-firmware.sh
‚ÑπÔ∏è  Found: update-cx7-firmware.sh
‚ÑπÔ∏è  Found: firmware-config.json
‚ÑπÔ∏è  Found: mlx-nic-health-check.sh
‚úÖ All required scripts found
2025-08-25 00:27:16 - TEST: Checking script permissions
‚ÑπÔ∏è  install-mft.sh is executable
‚ÑπÔ∏è  install-cx7-firmware.sh is executable
‚ÑπÔ∏è  update-cx7-firmware.sh is executable
‚ÑπÔ∏è  mlx-nic-health-check.sh is executable
‚úÖ All scripts have correct permissions
2025-08-25 00:27:16 - TEST: Validating JSON configuration files
‚úÖ firmware-config.json is valid JSON
‚ÑπÔ∏è  Found required field: firmware_mappings
‚ÑπÔ∏è  Found required field: latest_lts_versions
‚ÑπÔ∏è  Found required field: download_base_url
‚úÖ All required JSON fields present
2025-08-25 00:27:16 - TEST: Testing script help functions
‚ÑπÔ∏è  Testing help for install-mft.sh
‚úÖ install-mft.sh --help works
‚úÖ install-mft.sh -h works
‚ÑπÔ∏è  Testing help for install-cx7-firmware.sh
‚úÖ install-cx7-firmware.sh --help works
‚úÖ install-cx7-firmware.sh -h works
‚ÑπÔ∏è  Testing help for update-cx7-firmware.sh
‚úÖ update-cx7-firmware.sh --help works
‚úÖ update-cx7-firmware.sh -h works
2025-08-25 00:27:16 - TEST: Testing version detection functions (dry run)
‚ÑπÔ∏è  Testing MFT version detection logic
‚úÖ MFT version detection function found
‚úÖ MFT version validation function found
‚ÑπÔ∏è  Testing firmware version detection logic
‚úÖ Firmware version detection function found
‚úÖ Firmware mapping loader function found
2025-08-25 00:27:16 - TEST: Testing network connectivity for auto-detection
‚ÑπÔ∏è  Testing connectivity to: https://network.nvidia.com/products/adapter-software/firmware-tools/
‚úÖ ‚úì Reachable: https://network.nvidia.com/products/adapter-software/firmware-tools/
‚ÑπÔ∏è  Testing connectivity to: https://network.nvidia.com/support/firmware/connectx7/
‚úÖ ‚úì Reachable: https://network.nvidia.com/support/firmware/connectx7/
‚ÑπÔ∏è  Testing connectivity to: https://www.mellanox.com/downloads/MFT/
‚úÖ ‚úì Reachable: https://www.mellanox.com/downloads/MFT/
‚ÑπÔ∏è  Testing connectivity to: https://www.mellanox.com/downloads/firmware/
‚úÖ ‚úì Reachable: https://www.mellanox.com/downloads/firmware/
‚úÖ All required URLs are reachable
2025-08-25 00:27:18 - TEST: Testing command-line argument parsing
‚ÑπÔ∏è  Testing install-mft.sh argument parsing
‚úÖ install-mft.sh has argument parsing
‚ÑπÔ∏è  Testing install-cx7-firmware.sh argument parsing
‚úÖ install-cx7-firmware.sh has argument parsing
‚ÑπÔ∏è  Testing update-cx7-firmware.sh argument parsing
‚úÖ update-cx7-firmware.sh has argument parsing
2025-08-25 00:27:18 - TEST: Testing dependency availability
‚ÑπÔ∏è  Checking required dependencies:
‚úÖ ‚úì wget available
‚úÖ ‚úì curl available
‚úÖ ‚úì tar available
‚úÖ ‚úì unzip available
‚úÖ ‚úì lspci available
‚ÑπÔ∏è  Checking optional dependencies:
‚úÖ ‚úì jq available
‚ö†Ô∏è  ‚ö† flint missing (optional)
‚ö†Ô∏è  ‚ö† mst missing (optional)
‚ö†Ô∏è  ‚ö† mlxconfig missing (optional)
‚ö†Ô∏è  ‚ö† mlxlink missing (optional)
‚úÖ All required dependencies available
‚ÑπÔ∏è  Missing optional dependencies: flint mst mlxconfig mlxlink
‚ÑπÔ∏è  Install MFT tools for: flint, mst, mlxconfig, mlxlink
‚ÑπÔ∏è  Install jq for JSON parsing
2025-08-25 00:27:18 - TEST: Testing hardware detection capabilities
‚ÑπÔ∏è  Checking for ConnectX-7 devices...
‚úÖ Found 4 ConnectX-7 device(s)
‚ÑπÔ∏è    Device: 0000:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
‚ÑπÔ∏è    Device: 0000:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
‚ÑπÔ∏è    Device: 0001:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
‚ÑπÔ∏è    Device: 0001:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
‚ö†Ô∏è  MST tools not installed
2025-08-25 00:27:18 - TEST: Testing error handling and logging mechanisms
‚ÑπÔ∏è  Checking error handling in install-mft.sh
‚úÖ install-mft.sh has error handling
‚úÖ install-mft.sh has logging functions
‚ÑπÔ∏è  Checking error handling in install-cx7-firmware.sh
‚úÖ install-cx7-firmware.sh has error handling
‚úÖ install-cx7-firmware.sh has logging functions
‚ÑπÔ∏è  Checking error handling in update-cx7-firmware.sh
‚ö†Ô∏è  update-cx7-firmware.sh may lack comprehensive error handling
‚ö†Ô∏è  update-cx7-firmware.sh may lack logging functions
2025-08-25 00:27:18 - TEST: Testing security and safety features
‚ÑπÔ∏è  Checking security features in install-mft.sh
‚ö†Ô∏è  install-mft.sh may not check for root privileges
‚ö†Ô∏è  install-mft.sh may lack user confirmation prompts
‚ÑπÔ∏è  Checking security features in install-cx7-firmware.sh
‚úÖ install-cx7-firmware.sh checks for root privileges
‚úÖ install-cx7-firmware.sh has user confirmation prompts
‚úÖ install-cx7-firmware.sh includes backup functionality
‚ÑπÔ∏è  Checking security features in update-cx7-firmware.sh
‚ö†Ô∏è  update-cx7-firmware.sh may not check for root privileges
‚úÖ update-cx7-firmware.sh has user confirmation prompts
‚úÖ update-cx7-firmware.sh includes backup functionality
2025-08-25 00:27:18 - TEST: Integration test (dry run mode)
‚ÑπÔ∏è  Testing script integration without making changes...
‚ÑπÔ∏è  Testing update wrapper integration
‚úÖ Wrapper script references main installation script
‚úÖ Configuration file integration working

==========================================
           TEST REPORT SUMMARY
==========================================

Total Tests Run: 12
Passed: 12
Failed: 0

Success Rate: 100%

üéâ All tests passed! Scripts are ready for use.

Detailed log saved to: /tmp/mellanox-test-20250825_002716.log

Next Steps:
‚úÖ Scripts are ready for lab testing
‚úÖ Consider running with actual hardware for full validation
‚ÑπÔ∏è  Run as root for additional hardware-specific tests

sh-5.2$ 

===========================================

sh-5.2$ sudo ./install-mft.sh 
2025-08-25 00:32:53 - Starting Mellanox MFT installation
2025-08-25 00:32:53 - Auto-detection enabled, attempting to find latest LTS version...
2025-08-25 00:32:53 - Method 1: Parsing NVIDIA download page...
2025-08-25 00:32:53 - Method 2: Probing for common LTS versions...
2025-08-25 00:32:54 - ‚úÖ Found available version: 4.30.1-1210
2025-08-25 00:32:54 - ‚úÖ Using auto-detected version: 4.30.1-1210
2025-08-25 00:32:54 - Selected MFT version: 4.30.1-1210
2025-08-25 00:32:54 - Package: mft-4.30.1-1210-x86_64-rpm.tgz
2025-08-25 00:32:54 - Download URL: https://www.mellanox.com/downloads/MFT/mft-4.30.1-1210-x86_64-rpm.tgz

=== MFT Installation Summary ===
Version: 4.30.1-1210
Package: mft-4.30.1-1210-x86_64-rpm.tgz
Source: Auto-detected (latest available)
=================================

2025-08-25 00:32:54 - Installing dependencies...
Last metadata expiration check: 0:51:39 ago on Sun Aug 24 23:41:15 2025.
Package gcc-11.5.0-5.amzn2023.0.3.x86_64 is already installed.
Package rpm-build-4.16.1.3-29.amzn2023.0.6.x86_64 is already installed.
Package make-1:4.3-5.amzn2023.0.2.x86_64 is already installed.
Package elfutils-libelf-devel-0.188-3.amzn2023.0.2.x86_64 is already installed.
Package perl-4:5.32.1-477.amzn2023.0.6.x86_64 is already installed.
Package lshw-B.02.19.2-7.amzn2023.0.3.x86_64 is already installed.
Package jq-1.7.1-49.amzn2023.0.2.x86_64 is already installed.
Package wget-1.21.3-1.amzn2023.0.4.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!
2025-08-25 00:32:54 - Current kernel version: 6.1.132-147.221.amzn2023.x86_64
2025-08-25 00:32:54 - Installing kernel-devel for current kernel...
Last metadata expiration check: 0:51:40 ago on Sun Aug 24 23:41:15 2025.
Package kernel-devel-6.1.132-147.221.amzn2023.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!
2025-08-25 00:32:55 - Working in temporary directory: /tmp/tmp.tBSmSqivDP
2025-08-25 00:32:55 - Downloading MFT package from: https://www.mellanox.com/downloads/MFT/mft-4.30.1-1210-x86_64-rpm.tgz
--2025-08-25 00:32:55--  https://www.mellanox.com/downloads/MFT/mft-4.30.1-1210-x86_64-rpm.tgz
Resolving www.mellanox.com (www.mellanox.com)... 23.53.35.140, 23.53.35.143
Connecting to www.mellanox.com (www.mellanox.com)|23.53.35.140|:443... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://content.mellanox.com/MFT/mft-4.30.1-1210-x86_64-rpm.tgz [following]
--2025-08-25 00:32:55--  https://content.mellanox.com/MFT/mft-4.30.1-1210-x86_64-rpm.tgz
Resolving content.mellanox.com (content.mellanox.com)... 107.178.241.102
Connecting to content.mellanox.com (content.mellanox.com)|107.178.241.102|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 72212536 (69M) [application/gzip]
Saving to: ‚Äòmft-4.30.1-1210-x86_64-rpm.tgz‚Äô

mft-4.30.1-1210-x86_64-rpm.tgz 100%[====================================================>]  68.87M  20.7MB/s    in 3.8s    

2025-08-25 00:32:59 (18.3 MB/s) - ‚Äòmft-4.30.1-1210-x86_64-rpm.tgz‚Äô saved [72212536/72212536]

2025-08-25 00:32:59 - Download completed successfully
2025-08-25 00:32:59 - Extracting MFT package...
mft-4.30.1-1210-x86_64-rpm/LICENSE.txt
mft-4.30.1-1210-x86_64-rpm/RPMS/
mft-4.30.1-1210-x86_64-rpm/RPMS/mft-4.30.1-1210.x86_64.rpm
mft-4.30.1-1210-x86_64-rpm/RPMS/mft-oem-4.30.1-1210.x86_64.rpm
mft-4.30.1-1210-x86_64-rpm/RPMS/mft-autocomplete-4.30.1-1210.x86_64.rpm
mft-4.30.1-1210-x86_64-rpm/RPMS/mft-pcap-4.30.1-1210.x86_64.rpm
mft-4.30.1-1210-x86_64-rpm/SDEBS/
mft-4.30.1-1210-x86_64-rpm/SDEBS/kernel-mft-dkms_4.30.1-1210_all.deb
mft-4.30.1-1210-x86_64-rpm/SRPMS/
mft-4.30.1-1210-x86_64-rpm/SRPMS/kernel-mft-4.30.1-1210.src.rpm
mft-4.30.1-1210-x86_64-rpm/install.sh
mft-4.30.1-1210-x86_64-rpm/old-mft-uninstall.sh
mft-4.30.1-1210-x86_64-rpm/uninstall.sh
2025-08-25 00:33:00 - Running MFT installation...
-I- Removing any old MFT file if exists...
-I- Building the MFT kernel binary RPM...
-I- Installing the MFT RPMs...
Verifying...                          ################################# [100%]
Preparing...                          ################################# [100%]
Updating / installing...
   1:kernel-mft-4.30.1-6.1.132_147.221################################# [100%]
Verifying...                          ################################# [100%]
Preparing...                          ################################# [100%]
Updating / installing...
   1:mft-4.30.1-1210                  ################################# [100%]
Verifying...                          ################################# [100%]
Preparing...                          ################################# [100%]
Updating / installing...
   1:mft-autocomplete-4.30.1-1210     ################################# [100%]
-I- In order to start mst, please run "mst start".
2025-08-25 00:33:10 - MFT installation completed successfully
2025-08-25 00:33:10 - Starting MST service...
Starting MST (Mellanox Software Tools) driver set
Loading MST PCI module - Success
Loading MST PCI configuration module - Success
Create devices
-W- Missing "lsusb" command, skipping MTUSB devices detection
Unloading MST PCI module (unused) - Success
2025-08-25 00:33:11 - MST service started successfully
2025-08-25 00:33:11 - Verifying installation...
2025-08-25 00:33:11 - ‚úÖ mlxconfig command available
2025-08-25 00:33:11 - ‚úÖ mlxlink command available
2025-08-25 00:33:11 - ‚úÖ flint command available
2025-08-25 00:33:11 - MST Status:
MST modules:
------------
    MST PCI module is not loaded
    MST PCI configuration module loaded

MST devices:
------------
/dev/mst/mt4129_pciconf0         - PCI configuration cycles access.
                                   domain:bus:dev.fn=0000:05:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1
                                   Chip revision is: 00
/dev/mst/mt4129_pciconf1         - PCI configuration cycles access.
                                   domain:bus:dev.fn=0001:05:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1
                                   Chip revision is: 00

2025-08-25 00:33:11 - Temporary files cleaned up
2025-08-25 00:33:11 - Checking for ConnectX-7 devices...
2025-08-25 00:33:11 - ‚úÖ Found 4 ConnectX-7 device(s)
0000:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
0000:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
0001:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
0001:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
2025-08-25 00:33:11 - MFT installation script completed
2025-08-25 00:33:11 - Next steps:
2025-08-25 00:33:11 - 1. Run health check: sudo ./mlx-nic-health-check.sh
2025-08-25 00:33:11 - 2. Configure VFs if needed: sudo ./create-virtual-function.sh
2025-08-25 00:33:11 - 3. Check firmware versions and update if necessary

Installation completed! Check /var/log/mft-install.log for detailed logs.
sh-5.2$ 


======================================

sh-5.2$ sudo ./mlx-nic-health-check.sh
=== Mellanox NIC Health Check ===
Timestamp: Mon Aug 25 00:34:02 UTC 2025
Hostname: ip-10-0-49-172.ec2.internal
Starting MST service...
Starting MST (Mellanox Software Tools) driver set
Loading MST PCI module - Success
[warn] mst_pciconf is already loaded, skipping
Create devices
-W- Missing "lsusb" command, skipping MTUSB devices detection
Unloading MST PCI module (unused) - Success

=== MST Status ===
MST modules:
------------
    MST PCI module is not loaded
    MST PCI configuration module loaded

MST devices:
------------
/dev/mst/mt4129_pciconf0         - PCI configuration cycles access.
                                   domain:bus:dev.fn=0000:05:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1
                                   Chip revision is: 00
/dev/mst/mt4129_pciconf1         - PCI configuration cycles access.
                                   domain:bus:dev.fn=0001:05:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1
                                   Chip revision is: 00


=== Detecting ConnectX-7 Devices ===
Found 4 ConnectX-7 device(s): 0000:05:00.0 0000:05:00.1 0001:05:00.0 0001:05:00.1

========================================
=== Device: 0000:05:00.0 ===
========================================

--- Configuration Status ---
Device type:        ConnectX7           
Name:               MCX755106AS-HEA_Ax  
Description:        NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
Configurations:                                          Next Boot

--- Link Status ---
Port 1:
Operational Info
Physical state                     : LinkUp 
Speed                              : 200G 
Width                              : 4x 
Enabled Link Speed (Ext.)          : 0x00003ff2 (200G_2X,200G_4X,100G_1X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Supported Cable Speed (Ext.)       : 0x000017f2 (200G_4X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Port 2:
  Port 2 not available or link down

--- Firmware Information ---
FW Version:            28.40.1000
Product Version:       28.40.1000
Description:           UID                GuidsNumber
PSID:                  MT_0000000834

--- Temperature Monitoring ---
Temperature: 63             ¬∞C
‚úÖ Temperature normal (63             ¬∞C)

--- PCIe Information ---
                LnkCap: Port #0, Speed 32GT/s, Width x16, ASPM not supported
                LnkSta: Speed 32GT/s (ok), Width x16 (ok)
                LnkCap2: Supported Link Speeds: 2.5-32GT/s, Crosslink- Retimer+ 2Retimers+ DRS-
                LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete+ EqualizationPhase1+

========================================
=== Device: 0000:05:00.1 ===
========================================

--- Configuration Status ---
Device type:        ConnectX7           
Name:               MCX755106AS-HEA_Ax  
Description:        NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
Configurations:                                          Next Boot

--- Link Status ---
Port 1:
Operational Info
Physical state                     : LinkUp 
Speed                              : 200G 
Width                              : 4x 
Enabled Link Speed (Ext.)          : 0x00003ff2 (200G_2X,200G_4X,100G_1X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Supported Cable Speed (Ext.)       : 0x000017f2 (200G_4X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Port 2:
  Port 2 not available or link down

--- Firmware Information ---
FW Version:            28.40.1000
Product Version:       28.40.1000
Description:           UID                GuidsNumber
PSID:                  MT_0000000834

--- Temperature Monitoring ---
Temperature: 62             ¬∞C
‚úÖ Temperature normal (62             ¬∞C)

--- PCIe Information ---
                LnkCap: Port #0, Speed 32GT/s, Width x16, ASPM not supported
                LnkSta: Speed 32GT/s (ok), Width x16 (ok)
                LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete- EqualizationPhase1-

========================================
=== Device: 0001:05:00.0 ===
========================================

--- Configuration Status ---
Device type:        ConnectX7           
Name:               MCX755106AS-HEA_Ax  
Description:        NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
Configurations:                                          Next Boot

--- Link Status ---
Port 1:
Operational Info
Physical state                     : LinkUp 
Speed                              : 200G 
Width                              : 4x 
Enabled Link Speed (Ext.)          : 0x00003ff2 (200G_2X,200G_4X,100G_1X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Supported Cable Speed (Ext.)       : 0x000017f2 (200G_4X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Port 2:
  Port 2 not available or link down

--- Firmware Information ---
FW Version:            28.40.1000
Product Version:       28.40.1000
Description:           UID                GuidsNumber
PSID:                  MT_0000000834

--- Temperature Monitoring ---
Temperature: 62             ¬∞C
‚úÖ Temperature normal (62             ¬∞C)

--- PCIe Information ---
                LnkCap: Port #0, Speed 32GT/s, Width x16, ASPM not supported
                LnkSta: Speed 32GT/s (ok), Width x16 (ok)
                LnkCap2: Supported Link Speeds: 2.5-32GT/s, Crosslink- Retimer+ 2Retimers+ DRS-
                LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete+ EqualizationPhase1+

========================================
=== Device: 0001:05:00.1 ===
========================================

--- Configuration Status ---
Device type:        ConnectX7           
Name:               MCX755106AS-HEA_Ax  
Description:        NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
Configurations:                                          Next Boot

--- Link Status ---
Port 1:
Operational Info
Physical state                     : LinkUp 
Speed                              : 200G 
Width                              : 4x 
Enabled Link Speed (Ext.)          : 0x00003ff2 (200G_2X,200G_4X,100G_1X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Supported Cable Speed (Ext.)       : 0x000017f2 (200G_4X,100G_2X,100G_4X,50G_1X,50G_2X,40G,25G,10G,1G) 
Port 2:
  Port 2 not available or link down

--- Firmware Information ---
FW Version:            28.40.1000
Product Version:       28.40.1000
Description:           UID                GuidsNumber
PSID:                  MT_0000000834

--- Temperature Monitoring ---
Temperature: 62             ¬∞C
‚úÖ Temperature normal (62             ¬∞C)

--- PCIe Information ---
                LnkCap: Port #0, Speed 32GT/s, Width x16, ASPM not supported
                LnkSta: Speed 32GT/s (ok), Width x16 (ok)
                LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete- EqualizationPhase1-

========================================
=== Virtual Function Status ===
========================================

Device 0000:05:00.0:
  Configured VFs: 16
  ‚ö†Ô∏è  Partial VF configuration (16/127)

Device 0000:05:00.1:
  Configured VFs: 16
  ‚ö†Ô∏è  Partial VF configuration (16/127)

Device 0001:05:00.0:
  Configured VFs: 16
  ‚ö†Ô∏è  Partial VF configuration (16/127)

Device 0001:05:00.1:
  Configured VFs: 16
  ‚ö†Ô∏è  Partial VF configuration (16/127)

========================================
=== Network Interface Status ===
========================================
ConnectX-7 Network Interfaces:
  Interface: ens1f0np0 - Ethernet interface
  Interface: ens1f1np1 - Ethernet interface
  Interface: enP1s11f0np0 - Ethernet interface
  Interface: enP1s11f1np1 - Ethernet interface

========================================
=== Health Check Summary ===
========================================
Devices checked: 4
Timestamp: Mon Aug 25 00:34:31 UTC 2025
Status: Health check completed

üí° Tip: Run 'sudo systemctl status create-vf.service' to check VF creation service status
üí° Tip: Monitor logs with 'dmesg | grep -i mellanox' for hardware messages
sh-5.2$ 


================================================


sh-5.2$ sudo ./update-cx7-firmware-mlxup.sh
2025-08-25 02:11:28 - Starting ConnectX-7 firmware update using mlxup
2025-08-25 02:11:28 - Checking MFT tools installation...
2025-08-25 02:11:28 - mlxup not found, attempting to install...
2025-08-25 02:11:28 - Installing mlxup tool...
2025-08-25 02:11:28 - mlxup not found locally or in MFT installation, downloading from NVIDIA...
2025-08-25 02:11:28 - Downloading mlxup from NVIDIA website...
2025-08-25 02:11:28 - Detecting latest mlxup version...
2025-08-25 02:11:28 - Verifying version 4.30.0 is available...
2025-08-25 02:11:29 - ‚úÖ Confirmed version 4.30.0 is available
2025-08-25 02:11:29 - Using mlxup version: 4.30.0
2025-08-25 02:11:29 - Primary download URL: https://www.mellanox.com/downloads/firmware/mlxup/4.30.0/SFX/linux_x64/mlxup
2025-08-25 02:11:29 - Will try 5 different URL combinations...
2025-08-25 02:11:29 - Trying: https://www.mellanox.com/downloads/firmware/mlxup/4.30.0/SFX/linux_x64/mlxup
2025-08-25 02:11:34 - ‚úÖ Downloaded mlxup from: https://www.mellanox.com/downloads/firmware/mlxup/4.30.0/SFX/linux_x64/mlxup
2025-08-25 02:11:34 - Downloaded mlxup binary directly: mlxup-4.30.0
2025-08-25 02:11:34 - Installing mlxup to /usr/local/bin/
2025-08-25 02:11:34 - ‚úÖ mlxup installed successfully: mlxup 1.0, mft 4.30.0-139, built on Oct 27 2024, 10:34:38. Git SHA Hash: N/A
2025-08-25 02:11:34 - Temporary files cleaned up
2025-08-25 02:11:34 - ‚úÖ MFT tools are available
2025-08-25 02:11:34 - Starting MST service...
2025-08-25 02:11:35 - ‚úÖ MST service started successfully
2025-08-25 02:11:37 - Detecting ConnectX-7 devices...
2025-08-25 02:11:37 - ‚úÖ Found 4 ConnectX-7 device(s)
2025-08-25 02:11:37 - ConnectX-7 devices:
2025-08-25 02:11:37 -   0000:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
2025-08-25 02:11:37 -   0000:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
2025-08-25 02:11:37 -   0001:05:00.0 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
2025-08-25 02:11:37 -   0001:05:00.1 Ethernet controller: Mellanox Technologies MT2910 Family [ConnectX-7]
2025-08-25 02:11:37 - Querying available firmware updates...

=== FIRMWARE UPDATE QUERY ===
Querying Mellanox devices firmware ...

Device #1:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf1
  Base MAC:         5c2573a98bd4
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required

Device #2:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf0
  Base MAC:         5c257331e4dc
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required

2025-08-25 02:12:07 - ‚úÖ Firmware query completed successfully
=============================

2025-08-25 02:12:07 - Starting firmware update process...

=== FIRMWARE UPDATE PROCESS ===
2025-08-25 02:12:07 - Checking for firmware updates...
Querying Mellanox devices firmware ...

Device #1:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf1
  Base MAC:         5c2573a98bd4
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required

Device #2:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf0
  Base MAC:         5c257331e4dc
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required


‚ö†Ô∏è  FIRMWARE UPDATE WARNING ‚ö†Ô∏è
About to update firmware on all ConnectX-7 devices
This process:
- Will automatically download and install compatible firmware
- May require a system reboot to complete
- Should not be interrupted once started

Continue with firmware update? (yes/no): 

Continue with firmware update? (yes/no): yes
2025-08-25 02:12:57 - Executing firmware update...
2025-08-25 02:12:57 - Command: mlxup
Querying Mellanox devices firmware ...

Device #1:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf1
  Base MAC:         5c2573a98bd4
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required

Device #2:
----------

  Device Type:      ConnectX7
  Part Number:      MCX755106AS-HEA_Ax
  Description:      NVIDIA ConnectX-7 HHHL Adapter Card; 200GbE (default mode) / NDR200 IB; Dual-port QSFP112; PCIe 5.0 x16 with x16 PCIe extension option; Crypto Disabled; Secure Boot Enabled
  PSID:             MT_0000000834
  PCI Device Name:  /dev/mst/mt4129_pciconf0
  Base MAC:         5c257331e4dc
  Versions:         Current        Available     
     FW             28.40.1000     28.43.1014    
     PXE            3.7.0300       N/A           
     UEFI           14.33.0010     N/A           

  Status:           Update required

---------
Found 2 device(s) requiring firmware update...

Perform FW update? [y/N]: y
Device #1: Updating FW ...    

FSMST_INITIALIZE -   OK          
Writing Boot image component -   0% ... 100% (~5mins)

Writing Boot image component -   OK          
Done
Device #2: Updating FW ...  

Device #2: Updating FW ...     
FSMST_INITIALIZE -   OK          
Writing Boot image component -   0% ... 100% (~5mins)

Device #2: Updating FW ...     
FSMST_INITIALIZE -   OK          
Writing Boot image component -   OK          
Done

Restart needed for updates to take effect.
Log File: /tmp/mlxup_workdir/mlxup-20250825_021257_166516.log
2025-08-25 02:18:23 - ‚úÖ Firmware update completed successfully

‚úÖ Firmware Update Successful!

Next steps:
1. Reboot the system to activate new firmware:
   sudo reboot

2. After reboot, verify firmware versions:
   sudo ./mlx-nic-health-check.sh

2025-08-25 02:18:23 - Firmware update process completed successfully
2025-08-25 02:18:23 - Script execution completed
sh-5.2$ 

=============================================


sh-5.2$ sudo ./create-virtual-function.sh 
2025-08-25 02:44:38 - Starting Virtual Function creation script
2025-08-25 02:44:38 - ‚úÖ mlxconfig found - hardware VF configuration will be performed
2025-08-25 02:44:38 - Detecting ConnectX-7 network interfaces...
2025-08-25 02:44:40 - Found 4 ConnectX-7 interface(s): ens1f0np0 ens1f1np1 enP1s11f0np0 enP1s11f1np1
2025-08-25 02:44:40 - Configuring hardware VF limits using mlxconfig...
2025-08-25 02:44:40 - Processing Mellanox device: 0000:05:00.0
2025-08-25 02:44:43 - Current hardware VF limit for 0000:05:00.0: 127
2025-08-25 02:44:43 - Hardware VF limit already correct for 0000:05:00.0 (127)
2025-08-25 02:44:43 - Processing Mellanox device: 0000:05:00.1
2025-08-25 02:44:47 - Current hardware VF limit for 0000:05:00.1: 127
2025-08-25 02:44:47 - Hardware VF limit already correct for 0000:05:00.1 (127)
2025-08-25 02:44:47 - Processing Mellanox device: 0001:05:00.0
2025-08-25 02:44:50 - Current hardware VF limit for 0001:05:00.0: 127
2025-08-25 02:44:50 - Hardware VF limit already correct for 0001:05:00.0 (127)
2025-08-25 02:44:50 - Processing Mellanox device: 0001:05:00.1
2025-08-25 02:44:53 - Current hardware VF limit for 0001:05:00.1: 127
2025-08-25 02:44:53 - Hardware VF limit already correct for 0001:05:00.1 (127)
2025-08-25 02:44:53 - Processing interface: ens1f0np0
2025-08-25 02:44:53 - Current VFs for ens1f0np0: 0
2025-08-25 02:44:53 - Maximum supported VFs for ens1f0np0: 16
2025-08-25 02:44:53 - Attempting to create 127 Virtual Functions for interface: ens1f0np0
2025-08-25 02:44:53 - Current VFs: 0, Hardware maximum: 16
2025-08-25 02:44:53 - Step 1: Resetting VFs to 0 for ens1f0np0...
2025-08-25 02:44:53 - ‚úÖ Successfully reset VFs to 0 for ens1f0np0
2025-08-25 02:45:03 - Verified reset: ens1f0np0 now has 0 VFs
2025-08-25 02:45:03 - Step 2: Setting VFs to 127 for ens1f0np0...
2025-08-25 02:45:03 - ‚ùå Failed to set VFs to 127 for ens1f0np0
2025-08-25 02:45:03 -    This may indicate the hardware limit hasn't been applied yet (reboot required)
2025-08-25 02:45:03 - Processing interface: ens1f1np1
2025-08-25 02:45:03 - Current VFs for ens1f1np1: 0
2025-08-25 02:45:03 - Maximum supported VFs for ens1f1np1: 16
2025-08-25 02:45:03 - Attempting to create 127 Virtual Functions for interface: ens1f1np1
2025-08-25 02:45:03 - Current VFs: 0, Hardware maximum: 16
2025-08-25 02:45:03 - Step 1: Resetting VFs to 0 for ens1f1np1...
2025-08-25 02:45:03 - ‚úÖ Successfully reset VFs to 0 for ens1f1np1
2025-08-25 02:45:13 - Verified reset: ens1f1np1 now has 0 VFs
2025-08-25 02:45:13 - Step 2: Setting VFs to 127 for ens1f1np1...
2025-08-25 02:45:13 - ‚ùå Failed to set VFs to 127 for ens1f1np1
2025-08-25 02:45:13 -    This may indicate the hardware limit hasn't been applied yet (reboot required)
2025-08-25 02:45:13 - Processing interface: enP1s11f0np0
2025-08-25 02:45:13 - Current VFs for enP1s11f0np0: 0
2025-08-25 02:45:13 - Maximum supported VFs for enP1s11f0np0: 16
2025-08-25 02:45:13 - Attempting to create 127 Virtual Functions for interface: enP1s11f0np0
2025-08-25 02:45:13 - Current VFs: 0, Hardware maximum: 16
2025-08-25 02:45:13 - Step 1: Resetting VFs to 0 for enP1s11f0np0...
2025-08-25 02:45:13 - ‚úÖ Successfully reset VFs to 0 for enP1s11f0np0
2025-08-25 02:45:23 - Verified reset: enP1s11f0np0 now has 0 VFs
2025-08-25 02:45:23 - Step 2: Setting VFs to 127 for enP1s11f0np0...
2025-08-25 02:45:23 - ‚ùå Failed to set VFs to 127 for enP1s11f0np0
2025-08-25 02:45:23 -    This may indicate the hardware limit hasn't been applied yet (reboot required)
2025-08-25 02:45:23 - Processing interface: enP1s11f1np1
2025-08-25 02:45:23 - Current VFs for enP1s11f1np1: 0
2025-08-25 02:45:23 - Maximum supported VFs for enP1s11f1np1: 16
2025-08-25 02:45:23 - Attempting to create 127 Virtual Functions for interface: enP1s11f1np1
2025-08-25 02:45:23 - Current VFs: 0, Hardware maximum: 16
2025-08-25 02:45:23 - Step 1: Resetting VFs to 0 for enP1s11f1np1...
2025-08-25 02:45:23 - ‚úÖ Successfully reset VFs to 0 for enP1s11f1np1
2025-08-25 02:45:33 - Verified reset: enP1s11f1np1 now has 0 VFs
2025-08-25 02:45:33 - Step 2: Setting VFs to 127 for enP1s11f1np1...
2025-08-25 02:45:33 - ‚ùå Failed to set VFs to 127 for enP1s11f1np1
2025-08-25 02:45:33 -    This may indicate the hardware limit hasn't been applied yet (reboot required)
2025-08-25 02:45:33 - Virtual Function creation completed
2025-08-25 02:45:33 - Summary:
2025-08-25 02:45:33 -   ens1f0np0: 0 VFs
2025-08-25 02:45:33 -   ens1f1np1: 0 VFs
2025-08-25 02:45:33 -   enP1s11f0np0: 0 VFs
2025-08-25 02:45:33 -   enP1s11f1np1: 0 VFs
2025-08-25 02:45:33 - Script execution finished
sh-5.2$ 


==================================

